(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-0d688173"],{5333:function(t,e,s){},6976:function(t,e,s){"use strict";var n=s("5333"),r=s.n(n);r.a},"6f29":function(t,e,s){"use strict";s.r(e);var n=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"container"},[s("navHeader",{attrs:{title:t.topName}}),s("div",{ref:"chatView",staticClass:"chat-view",on:{touchstart:t.touchstart}},t._l(t.dataList,(function(t){return s("chat-cell",{key:t._id,attrs:{data:t}})})),1),s("div",{class:t.bottomClass,style:t.bottomStyle},[s("inputBar",{ref:"inputBar",attrs:{option:{}},on:{publish:t.publish,uploaded:t.uploaded,showBottom:t.showBottom,hideBottom:t.hideBottom,hideBottomOnPanel:t.hideBottomOnPanel}})],1)],1)},r=[],i=(s("a481"),s("96cf"),s("3b8d")),a=(s("7f7f"),s("c732")),o=s("94ae"),c=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{class:t.data.mine?"chat-item chat-item-mine":"chat-item"},[s("img",{staticClass:"avatar",attrs:{src:t.data.fromUser.avatar,alt:"avatar"}}),s("div",{staticClass:"right-content"},[s("p",{staticClass:"nickname one-line"},[t._v(t._s(t.data.fromUser.nickname))]),"str"===t.data.content.type?s("div",{staticClass:"chat-text left-arrow"},[t._v(t._s(t.data.content.value))]):t._e(),"pic"===t.data.content.type?s("img",{staticClass:"chat-image",style:t.imgOneStyle(t.data.content.value),attrs:{src:t.getimageurl(t.data.content.value.url),alt:"pic"},on:{click:function(e){return t.showimage(t.data.content.value)}}}):t._e()])])},u=[],h={name:"chatCell",props:{data:Object},methods:{showImage:function(t){new Slider({list:[{img:t.url,height:t.size.height,width:t.size.width}],page:0})},getImageUrl:function(t){var e=t+"?x-oss-process=image/resize,l_300";return e},pxtovw:function(t){return t/375*100+"vw"}},computed:{imgOneStyle:function(){var t=this;return function(e){var s=null,n=null;return e.size.height>e.size.width?(s=Math.min(120,e.size.height),n=s*e.size.width/e.size.height):(n=Math.min(120,e.size.width),s=n*e.size.height/e.size.width),{height:t.pxtovw(s),width:t.pxtovw(n)}}}}},l=h,m=(s("70a7"),s("2877")),d=Object(m["a"])(l,c,u,!1,null,"78422664",null),f=d.exports,p=s("c40d"),v=s("f298"),w={name:"chat",components:{navHeader:o["a"],inputBar:a["a"],chatCell:f},props:{},data:function(){return{bottomClass:"bottom-view",bottomStyle:"",topName:this.$route.query.name||"",toUserId:this.$route.query.id,dataList:[]}},created:function(){this.$store.state.currentUser&&this.$store.state.currentUser._id&&this.$socket.emit("login",this.$store.state.currentUser),this.fetchData()},beforeDestroy:function(){this.$store.state.currentUser&&this.$store.state.currentUser._id&&this.$socket.emit("loginout",this.$store.state.currentUser)},sockets:{recieveMsg:function(t){t.fromUser._id===this.toUserId&&this.afterCommit({content:t.content,fromUser:t.fromUser})},reconnect:function(t){this.$store.stete.currentUser&&this.$store.currentUser._id&&this.$socket.emit("login",this.$store.state.currentUser)}},methods:{fetchData:function(){var t=Object(i["a"])(regeneratorRuntime.mark((function t(){var e;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,p["a"].get("message/getchathistory",{toUser:this.toUserId});case 2:e=t.sent,this.dataList=e.data;case 4:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}(),scrollToEnd:function(t){var e=this.$refs.chatView;t?e.scrollTop=e.scrollHeight:setTimeout((function(){e.scrollTop=e.scrollHeight}),200)},publish:function(){var t=Object(i["a"])(regeneratorRuntime.mark((function t(e){var s,n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e.value){t.next=2;break}return t.abrupt("return");case 2:return s={toUser:this.toUserId,content:{type:"str",value:e.value}},t.next=5,p["a"].post("message/addmsg",s);case 5:n=t.sent,this.afterCommit({content:{type:"str",value:e.value},fromUser:this.$store.state.currentUser,mine:!0}),0!==n.code&&weui.topTips("发送失败");case 8:case"end":return t.stop()}}),t,this)})));function e(e){return t.apply(this,arguments)}return e}(),uploaded:function(){var t=Object(i["a"])(regeneratorRuntime.mark((function t(e){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:({toUser:this.toUserId,content:{type:"pic",value:e.data}}),this.afterCommit({content:{type:"pic",value:e.data},fromUser:this.$store.state.currentUser,mine:!0}),0!==resp.code&&weui.topTips("发送失败");case 3:case"end":return t.stop()}}),t,this)})));function e(e){return t.apply(this,arguments)}return e}(),afterCommit:function(t){var e=this;this.dataList.push(t),this.$nextTick((function(){e.scrollToEnd()}))},closePanel:function(){this.bottomStyle="",this.bottomClass=this.bottomClass.replace("show",""),this.$refs.inputBar.closePanel()},touchstart:function(){this.closePanel(),this.$refs.inputBar.closePanel()},pxtovw:function(t){return t/375*100+"vw"},showBottom:function(){this.bottomClass.indexOf("show")>-1?this.bottomStyle="":this.bottomClass+="show"},hideBottom:function(){this.closePanel()},hideBottomOnPanel:function(t){this.scrollToEnd(!0),this.bottomClass.indexOf("show")>-1&&(v["a"].isIOS?window.scroll(0,70):this.closePanel())}}},g=w,b=(s("6976"),Object(m["a"])(g,n,r,!1,null,"5509ae44",null));e["default"]=b.exports},"70a7":function(t,e,s){"use strict";var n=s("9b4d"),r=s.n(n);r.a},"9b4d":function(t,e,s){}}]);
//# sourceMappingURL=chunk-0d688173.360de261.js.map